{
  "type": "object",
  "properties": {
    "step_id": { "type": "integer" },
    "findings": {
      "oneOf": [
        { "type": "null" },
        {
          "type": "object",
          "properties": {
        "summary": {
          "type": "string",
          "description": "Main analysis summary for this step"
        },
        "article": {
          "type": "string",
          "description": "Comprehensive article placed between headline findings and deep analysis; must fully answer the step goal with overview and in-depth reasoning"
        },
        "points_of_interest": {
          "type": "object",
          "description": "Structured points of interest extracted from this analysis",
          "properties": {
            "key_claims": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "claim": { "type": "string" },
                  "supporting_evidence": { "type": "string" },
                  "relevance": { 
                    "type": "string",
                    "enum": ["high", "medium", "low"]
                  }
                },
                "required": ["claim"]
              }
            },
            "controversial_topics": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "topic": { "type": "string" },
                  "opposing_views": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "intensity": {
                    "type": "string",
                    "enum": ["high", "medium", "low"]
                  }
                },
                "required": ["topic"]
              }
            },
            "surprising_insights": {
              "type": "array",
              "items": { "type": "string" }
            },
            "specific_examples": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "example": { "type": "string" },
                  "context": { "type": "string" },
                  "source_indicator": { "type": "string" }
                },
                "required": ["example"]
              }
            },
            "open_questions": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "analysis_details": {
          "type": "object",
          "description": "Step-specific detailed analysis (flexible structure)"
        }
      },
      "required": ["summary", "article"]
        }
      ]
    },
    "insights": { "type": "string" },
    "confidence": { "type": "number" },
    "requests": {
      "type": "array",
      "description": "Optional list of content retrieval requests",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "description": "Request identifier" },
          "request_type": {
            "type": "string",
            "enum": ["full_content_item", "by_marker", "by_topic", "selective_markers", "keyword", "word_range", "semantic"],
            "description": "Type of retrieval request"
          },
          "source_link_id": { "type": "string", "description": "Content item link_id" },
          "content_type": {
            "type": "string",
            "enum": ["transcript", "comments"],
            "description": "Content type for legacy requests"
          },
          "content_types": {
            "type": "array",
            "items": { "type": "string", "enum": ["transcript", "comments"] },
            "description": "Content types for full_content_item or by_topic requests"
          },
          "marker_text": { "type": "string", "description": "Marker text for by_marker request" },
          "topic": { "type": "string", "description": "Topic for by_topic request" },
          "source_link_ids": {
            "type": "array",
            "items": { "type": "string" },
            "description": "List of link_ids for by_topic request"
          },
          "marker_types": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Marker types for selective_markers request"
          },
          "context_window": { "type": "integer", "description": "Context window size for by_marker request" },
          "limit_items": { "type": "integer", "description": "Limit items for by_topic request" },
          "reason": { "type": "string", "description": "Reason for the request" },
          "priority": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "Priority level for the request"
          },
          "method": {
            "type": "string",
            "enum": ["keyword", "word_range", "semantic"],
            "description": "Method for legacy requests"
          },
          "parameters": {
            "type": "object",
            "description": "Parameters for legacy requests or semantic search",
            "properties": {
              "query": { "type": "string", "description": "Query text for semantic search" },
              "top_k": { "type": "integer", "description": "Optional limit for semantic matches" }
            }
          },
          "chunk_types": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Optional chunk type filter for semantic retrieval"
          }
        },
        "required": ["id", "request_type"]
      }
    },
    "missing_context": {
      "type": "array",
      "description": "Legacy missing context hints (deprecated, use requests instead)",
      "items": {
        "type": "object",
        "properties": {
          "need": { "type": "string" },
          "source": { "type": "string" },
          "search_hint": { "type": "string" }
        }
      }
    }
  },
  "required": ["step_id", "insights", "confidence"]
}


