1.7 版本发布

亮点

1. 数据加载增强与质量评估 - 新增数据可用性跟踪和内容质量评估功能。系统现在可以自动跟踪每个链接的数据可用性（转录、评论数量等），并在数据加载时进行质量评估，为后续研究阶段提供更可靠的数据基础。
2. Phase 3 顺序分块处理优化 - 改进 Phase 3 执行阶段的顺序分块处理机制，支持上下文保留和智能分块。在处理大型内容时，系统能够更好地保持上下文连续性，提升研究分析的连贯性和深度。
3. 智能采样策略优化 - 优化内容采样逻辑，支持多点采样（转录）和基于参与度的采样（评论）。系统能够更智能地选择代表性内容，在保证分析质量的同时提升处理效率。
4. 检索配置精细化 - 新增可配置的检索参数，支持自定义窗口大小、重叠度、最大窗口数等。用户可以根据研究需求灵活调整检索策略，平衡分析深度和处理效率。

新增功能

数据加载增强
数据可用性跟踪 - ResearchDataLoader 新增数据可用性跟踪
- 跟踪每个链接的转录可用性（has_transcript）
- 跟踪评论数量（comment_count）
- 跟踪转录字数（transcript_word_count）
- 提供数据完整性指标，便于评估研究数据质量

内容质量评估 - 新增内容质量评估功能
- 自动评估转录内容的质量
- 评估评论数据的代表性
- 为研究阶段提供质量指标参考

Phase 3 顺序分块处理
上下文保留机制 - 改进顺序分块处理
- 支持跨分块的上下文保留
- 维护分块之间的逻辑连续性
- 提升大型内容分析的一致性

分块跟踪系统 - 新增分块跟踪功能
- 使用 _chunk_tracker 跟踪已处理的分块
- 支持分块级别的上下文传递
- 优化分块处理顺序和依赖关系

智能采样策略
多点采样（转录） - 优化转录内容采样
- 支持从转录内容中提取多个采样点
- 确保采样内容的代表性和多样性
- 提升内容摘要的准确性

基于参与度的评论采样 - 优化评论采样逻辑
- 根据评论的参与度（点赞、回复等）进行智能采样
- 优先选择高质量和有代表性的评论
- 平衡采样数量和分析质量

检索配置增强
可配置检索参数 - 新增检索配置选项
```yaml
research:
  retrieval:
    window_words: 3000  # 检索窗口大小（字数）
    window_overlap_words: 400  # 窗口重叠字数
    max_windows_per_step: 8  # 每步最大窗口数
    max_followups_per_step: 2  # 每步最大后续请求数
    min_chars_per_request_item: 400  # 每个请求项最小字符数
    max_chars_per_request_item: 4000  # 每个请求项最大字符数
    min_total_followup_chars: 1500  # 后续请求最小总字符数
    max_total_followup_chars: 20000  # 后续请求最大总字符数
    max_seconds_per_step: null  # 每步最大时间预算（可选）
```

动态配置加载 - 支持从配置文件动态加载检索参数
- 自动应用配置的检索参数
- 提供参数验证和合理性检查
- 支持运行时参数调整

修复与改进

数据加载改进
数据完整性检查 - 改进数据加载的完整性检查
- 自动检测缺失的转录或评论数据
- 提供数据可用性报告
- 优化错误处理和异常恢复

元数据跟踪 - 增强元数据跟踪功能
- 更详细的源信息跟踪
- 改进数据来源映射
- 支持多源数据整合

Phase 3 处理优化
分块处理性能 - 优化分块处理性能
- 减少不必要的上下文传递
- 优化分块大小计算
- 改进分块处理顺序

上下文管理 - 改进上下文管理机制
- 更智能的上下文选择
- 优化上下文大小控制
- 提升上下文相关性

代码质量
类型安全增强 - 改进类型定义和类型检查
- 更严格的类型注解
- 改进类型推断
- 提升代码可维护性

错误处理改进 - 增强错误处理和日志记录
- 更详细的错误信息
- 改进异常恢复机制
- 优化调试支持

依赖更新

后端依赖
- 无需新增外部依赖，使用现有基础设施
- 建议更新到最新版本的依赖包以获得更好的性能

配置更新
- 新增 research.retrieval.* 配置组，支持检索参数自定义
- 所有配置向后兼容，未配置的参数使用默认值
- 数据加载增强无需额外配置，自动启用

迁移指南

从 v1.6 升级到 v1.7

1. 更新依赖
   ```bash
   pip install -r requirements.txt --upgrade
   cd client && npm install
   ```

2. 更新配置文件（可选）
   - 如需自定义检索参数，可在 config.yaml 中添加 research.retrieval.* 配置组
   - 默认配置已优化，大多数用户无需修改
   - 数据可用性跟踪和质量评估自动启用

3. 验证新功能
   - 创建新的研究会话，验证数据加载增强
   - 检查数据可用性跟踪是否正常工作
   - 验证 Phase 3 顺序分块处理是否改进

4. 测试检索配置
   - 如需要，调整检索参数以适应特定研究需求
   - 验证参数调整是否生效
   - 检查处理性能是否改善

使用示例

自定义检索配置

调整检索窗口大小：
```yaml
research:
  retrieval:
    window_words: 5000  # 增大窗口以处理更长的内容
    window_overlap_words: 500  # 相应调整重叠度
    max_windows_per_step: 10  # 增加每步最大窗口数
```

控制后续请求：
```yaml
research:
  retrieval:
    max_followups_per_step: 3  # 允许更多后续请求
    min_total_followup_chars: 2000  # 提高最小字符数要求
    max_total_followup_chars: 25000  # 提高最大字符数限制
```

数据质量评估

查看数据可用性：
- 系统自动跟踪每个链接的数据可用性
- 在数据加载阶段提供数据完整性报告
- 为研究阶段提供质量指标参考

质量评估指标：
- 转录字数统计
- 评论数量统计
- 数据完整性标记
- 内容代表性评估

已知问题

- 大型内容处理 - 处理非常大的内容时，顺序分块可能需要较长时间，建议根据内容大小调整检索参数
- 采样策略 - 采样策略基于启发式算法，可能不适用于所有内容类型，未来版本可能会提供更多可配置选项
- 配置复杂度 - 检索参数较多，建议根据实际需求逐步调整，避免过度配置

技术细节

数据可用性跟踪流程

数据加载时跟踪：
1. 初始化跟踪结构 - 为每个链接初始化数据可用性跟踪结构
2. 转录数据检查 - 检查转录内容是否存在，统计字数
3. 评论数据检查 - 检查评论数据，统计评论数量
4. 元数据更新 - 更新数据可用性元数据
5. 质量评估 - 基于可用性数据评估内容质量

数据结构：
```python
data_availability = {
    "has_transcript": bool,
    "has_comments": bool,
    "transcript_word_count": int,
    "comment_count": int
}
```

顺序分块处理机制

分块处理流程：
1. 内容分块 - 将大型内容分割为多个分块
2. 分块跟踪 - 使用 _chunk_tracker 跟踪已处理的分块
3. 上下文传递 - 在处理新分块时传递前序分块的上下文
4. 连续性维护 - 确保分块之间的逻辑连续性
5. 结果整合 - 整合所有分块的处理结果

上下文保留策略：
- 保留前序分块的关键信息
- 维护分块之间的逻辑关系
- 优化上下文大小和相关性

智能采样算法

多点采样（转录）：
- 从转录内容中提取多个代表性采样点
- 确保采样点覆盖内容的关键部分
- 平衡采样数量和代表性

基于参与度的评论采样：
- 根据评论的参与度指标（点赞、回复等）排序
- 优先选择高参与度评论
- 确保采样的多样性和代表性

检索参数说明

窗口配置：
- window_words: 检索窗口大小，控制每次检索的内容范围
- window_overlap_words: 窗口重叠字数，确保连续性
- max_windows_per_step: 每步最大窗口数，控制处理深度

后续请求配置：
- max_followups_per_step: 每步最大后续请求数
- min_chars_per_request_item: 每个请求项最小字符数
- max_chars_per_request_item: 每个请求项最大字符数
- min_total_followup_chars: 后续请求最小总字符数
- max_total_followup_chars: 后续请求最大总字符数

时间预算（可选）：
- max_seconds_per_step: 每步最大时间预算，用于控制处理时间

发布日期: 2025-11-20
版本号: v1.7.0
最低 Python 版本: 3.9+
最低 Node.js 版本: 18+
