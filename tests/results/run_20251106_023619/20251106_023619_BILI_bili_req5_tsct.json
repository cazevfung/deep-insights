{
  "success": true,
  "bv_id": "BV1mPEWzkEAh",
  "url": "https://www.bilibili.com/video/BV1mPEWzkEAh/",
  "content": "呃，分享给大家，然后方便大家在呃使用百度像素库的路上少踩坑，然后直接落地，满足效呃那个效果满意的一个哎压应用。下面我会分三个部分进行今天的一个分享。第一个部分就是产品的一个概述，第二部分的话就是最佳实践。第三部分的话会案例分享最佳实践是我们今天的呃重点分享的一个呃部分。那么我们先来啊看一下那个我们的百度呃AI云原生的一个向量数库record db。Record db的话就是它是具备海量的一个向量存储的一个能力，支持分布式架构，可以轻松应对E级别的一个向量的一个数据和10万级别的一个分片分片的一个需求。不仅可以存储那个向量数据，还可以同时支持结构化的一个标量数据。最高也支持4096维的一个高为向量，并且支持向量索引的一个量化压缩，可以帮助我们在使用的过程当中节省存储的一个空间。在访问性能方面的话，向量数据库呃支持多种高性能的一个向量检索的一个算法。比如H M S W park P Q等。能够这些算法的话能够呃帮助我们的用户能够实现毫秒级的一个向量检索的一个访问。通过架构和数据引擎的一个多方面的优化，vidb在各个类型的一个业务场景下面的性能表现的话，基本上都会比开源产品高到3到7.5倍。然后对于大部分开发来说，大大模型的一个开发来说的话，db也做了深度的一个适配，目前他支持主流的lm的一个框架集成开发，比如可以无缝对接到那么index divide或者是faster射等，并且集成了百度自研的千的invbed模型，尤其适合中文语料和知识图谱的训练。在中文实体和短语语义的场景表现的都是比较好的。而在弹性而高可用方面的话，db支持弹性的伸缩，最大可以拓展到上千个节点。分布式高可用架构也保证9991个五的一个可用性。然后数据零丢失，恢复时间也比较快。系统内部的话也呃自带自动化的一个管理和监控，支持云盘和本地盘都没问题，可以满足不同企业的一个部署的需求。然后可以看一下我们整个的一个外B的技术体系，呃，无论从内核和生态管理和平台方面的话，可以看得出来整个wadb它是一套呃无论从内到外都是一套比非常完善的一项一套产品系统。而外db的话是拥有成熟的分布式架构的，具备高可靠、高可用、高扩展和那个大规模的一个能力。系统也分为代理节点、数据节点和管理节点，支持负载均衡自动fe这些特性肯定是标配了确保业务的呃可用性和数据安全。通过这些能力的话，个B可以给企业带来呃在文本检索、图片检索或者是推荐系统大模型推理知识库这些多种A场景下面的话呃，快速安全的一个检索呃，限量检索的一个需求。那么在呃我们接下来的话已经有这个产品了，那么我们要怎么样才能够用好这些呃这个产品，并且在落地里面的话少踩坑呢？这里的话我们会呃在一些实际的应用中总结了一些最佳实践，帮大家更好的理解怎么去用好这款呃线上数据库。然后首先是数据建模，在我们设计业务的时候，数据建模肯定是第一步。呃，外db的话推荐就采用一个组件，一列向量和多元数据这种三放式进行一个设计。简单来说就是每条数据有唯一的组件，比如说字字符串或是U ID来保证数据写入和更新的唯一性。而向量列一般来说是用来存存储那个模型生成的向量，建议只保留一个主向量列，特殊场景下可以考虑多种向量列。这种特殊场景的话就是呃指我们例如说我们呃一个视频视频检索的一个场景。视频通常它都会有呃自己的一个描述文本，是可以作为一个向量，而它视频也会到有自己的音频，音频也可以作为一个向量，而视频它自己的视频帧或者是整个视频也可以作为向量。在这种场景下面的话，它需要可能就需要有三个向量列来组成一个特殊的一个多向量列的一个场景。而元数据列则是用来存储一些辅助的信息，比如说标签状态这些。然后类型的话可以是布呃布尔类型或整形字符串或者是map。但是块有一个注要注意的点就是避免存储大文本。为什么要这么设计呢？因为的话一旦有呃多个向量列的话，其实这里呃多个向量列同时参与同查的话，系统会强制多次进行一个呃向量的具体体计算。这样的话肯定就会呃导致查询会变慢，而原数据列越精简，过滤就会越快，而所以也会越小，能帮呃我们在资源上面节省更多的资源。那呃在数据建模的时候，很多同学也会关心一个问题啊，那那就是到底该用多少维度的向量。其实这里有一个非常实用的一个原则，那就是呃维度跟着呃维度跟着模型走。这个什么意思呢？就是说我们在做向量检索的时候，通常都会用到各种embedding的模型。比如说文本、图片框模态这些都会都有它对应的模型。每个模型在开盘呃开箱即即用的时候，通常都都会默认它都会带有一个默认的向量输出的一个长短长度，这个的话就是它的维度。比如说我们的一个B G base的这么一个中文语义的检索模型，它的一个输出的向量维度就是768维，而B B蜡的这个是101024维。而英语检索的这种常用的呃15 base或是BGM3，分别也是768和1024。图片检索的clip这个模型它就有512和768。像这种模型的话呃他们都会自带，它有固定的一个默认长度。这里的话要特别提醒大家的是，我们选择选型的时候，不要反过来选为了某个维度去选模型，而是要先看业务的语料和部署的资源。因为模型选定之后，呃，维度就自然就呃顺顺带的就决定了。比如你做的是中文中文检索的faq的检索。那么肯定就是需要优先考虑的就是B G base的一个呃中文的模型，或是B G large的一个中文模型。维度的话就是768和1024维。同理图片检索的话，那就是clip的那个系列维度也基本上都会定下来。最后选型的时候还要结合实际的一个部署资源。比如说我们的维度呃越高的时候，存储和检索的资源消耗也会有相应的增加。如果你的业务对性能和成本有严格的要求，可以优先选择维度适中的模型，然后既保证那个效果，也能够控制资源的消耗。总之在呃数据建模的时候，embedding模型的一个选择和向量维度的确确认是顺带的，不是反选的。先看业务的需求和资源，再选模型维度就自然就定下来了。那么既然我们定好呃那个表格和定好维度，那么还有一些比较重要的点就是我们的一个数据的分区和副本数的设定，这个也是非常重要的。分区和副本副本数是呃可以在定义那个表的时候自定义的。我们建议的单个分区建议的呃那个数据量的数量的话就是少于1000万条向量。因为的话少于1000万条向量的话，基本上所有的数据都会集中在一个分区，在这个分区里面的话，我们检索就不需要说跨多个分区做多次的一个分布式的一个计算。这样子的话既节省资源，也能够提高那个检索的数呃效率。而控制单个分区的大小的话，呃，节省的资源就是节省是内存的资使用。因为构建索引的时候是按照分片来进行的，这里分片就是说我们的分区，而分区的话越大，构建索引所需要的空间就会越越多。所以的话我们呃分区设是呃设制造合合适的话，那么我们就不需要用于太多的资源呃留给构建索引的时候用。而副本数的增加的话，相应的它查询能力就会相应的线性的提升。但是话的写入速度是不会变的，相应的那个呃副本数增加之后，资源也是相应线性的提升，这个就是呃很合理的一个那个原则。因为的话你用了更多的资源来呃满足更大的一个查询量，但是的话你相应的成本就会增加。所以的话合理的分配啊那个分区和副本设定的话，其实是有利于平衡你的性能和资源的一个消耗。那么我们在呃呃虚库建完表之后，我们有什么方法去优化我们的一个查询查询的一个呃手段呢？其实这里的话我会主要以我们提供的呃几大索引来告诉大家每一种索引的效用。然后怎么应该应用到一个什么样的场景，然后具体应该怎么用。那么最基本最重要的一个索引，其实这个就是组件索引了。组件索引其实对大家来说都比较熟悉，但是在向量数据库里面，它一样是一个高效检索的一个核心。什么是组件索引？简单的简单点来说就是组件索引就是用来唯一标识每一行数据的每张表。在创建的时候系统会自动为组件字段生成组件索引。其其实这里的话就无需我们呃指定了。这就意味着只要我们在表格里面声明了哪个字段字段是组件，比如说ID字段系统的话就会自动的帮我们建好那个索引，也不用说额外去创建组件。索引的作用其实这里就非常关键了。它能够让我们在海量的数据里面快速精准的定位到某一条的具体的数据。比如说我们要查询某个用户的详详细信息，只要知道组件ID就能瞬间查到对应的数据。行，除了查询组件索引，还支持高效的数据更新和删除操作。比如你要根据ID更新一条数据或者是删除一条数据，有了组件索引的话，这一操作就呃非常快的能够完成。Ok那说完呃组建索引之后，那么在我们日常的业务里面的话，我们经常会遇到这样的一种需求。就是说除了组件查询数据之外，还需要根据其其他的字段进行筛选。比如说除了ID之外，我们还想要按照状态类型、时间这些条件进行一个呃查询过滤。这个时候的话二级索引就非常有用了。什么是二级索引？简单来说就是二级索引就是针对组件以外的字段建立的呃索引。这里的字段的话，我们目前暂定呃是限定为是标量字段。它的作用就是加速带有过滤条件，也就是v子句的一些查询操作，比如说呃select delete query这些。举个例子的话就是说如果我们有一个user ID和呃schedule的一个字段，然后我们呃经常需要根据这个字段来筛选用户的话，那么就可以为他建立一个二级缩引，这样子的话每次查找的时候就会快很多。呃，那为什么有这个二级索引的出现呢？因为如果没有二呃这个二级索引，数据库每次都需要进行一个全表的扫描。这个的话效率会大大的呃拉低你整个的查询效率。就尤其在数据量大的时候，查询会非常的慢。特别是百万级、千万级或者亿级别的那个查询，基本上能够把你整个数据库的性能都为托管。而有了二级索引的话，数据库就可以直接定位到符合条件数据，大大提提升了查询的一个呃性能。在实际使使用上面的话有几个建议，首先建议对高频过滤的字段建立二级缩影。比如说经常用来筛选的呃排序的、统计的字段，这些都可以考虑加索引。其次的话二级索引不仅可以呃加速查查询，还可以优化带有呃条件的删除更新，这些都可以用的。最后索引的话其实不是越多越好，还要结合实际的业务场景，优先保证高频和核心的字段进行一个查询效率。好过完二级索引的话，我们呃还下一个的话就是说在我们向量数据库的检索优化里面的话，呃，filter索引这个也是一个非常实用的一个手段。尤其是在我们需要向量加结构化组合查询的时候，这种的话就可以大大提高我们的检索的效率。Filter索引的作用是什么呢？它是专门用于向量检索中的一个条件过滤优化。比如说我们在做向量相似性的检索时候，往往都会加上一些结构化的条件。比如说只查状态为已经发布的文件，或者是只查某个知识库下的呃数据。如果没有过滤呃呃这种过滤索引的话，系统就需要对所有的向量数据进行一个向量计算，这样子个效率会很低。而有了fil索引之后，系统可以先把不符合条件的数据过滤掉，然后只对剩下的数据做向量的一个检索，但大减少了计算的量。好，现在db支持两种类型的呃过滤索引。第一种的话是de的那个filter默认的一个过滤索引。适用的场景的话就是字段类型比较呃复杂，或是离散度比较高，取值多的。怎么理解这个呢？就是我们的一个呃呃文档ID或者是知识库ID这种基本上不会有重样的，就是重叠度很很低的这种值的话是可以直接用默认的default啊filter。而那个在我们的一个字段种类较少，类似于说我们的枚举特征的性别等级状态。性别的话因为就只有两种男女或者是呃等级的话可能有一些level，1到60就只有十个值。但这块可能在100万个数据里面，他还是只有十个值。在这种的话就可以用bit mfil呃filter，这种的话就可以利用呃成的话可以利用呃位图加速集合运算，然后具备更高的一个呃空间和查询的效率，这这种的话就会比较油。而在其除了前面那些常规的索引之外的话，针对标量字段的话，其实这一块还会有一种叫做倒排索引。倒排索引的话是的实现是呃全文检索能力的一个核心的技术。它在文本类型的一个检索场景下面的话，几乎是不可或缺的。什么是倒排索引？简单的来说就是倒排索引，就是一个为文本字段建立的一个关键词到文本的映射表。比如说你有一批文本文档，每个文档里面有很多词，倒排索引的话会记录每个词出现在哪些文档里面。这样子的话当我们要查询包含某些关键词的所有文档的时候，就可以非常高效的定位到结果。并不需要全表扫描，而倒排索引的作用非常大，它不仅能够支持关键词的快速检索，还能实现短语匹配、模糊查询这些复杂的文本搜索功能。比如说你想查智能汽车这个的短词，或者是查所有包含AI关键词的对内容有倒排索引的话，系统可以瞬间返回你所有你想要的结果。而在实际应用过程当中的话，倒排索引最适合用的话也是在那个全文检索的场景里面。比如说新闻商品评论这些文本内容的检索，或者是在搜索引擎知识库里面呃，也会实现到基于关键词的高效定位。我们也可以看到那个ppt右边里面的话，我们呃可以通过map或map呃test等一些语法来灵活的实现各种文本的一些检索的需求。那么说完所有的标量呃字段，那么到我们呃最核心的一个呃向量检索这么一个呃索引。向量的索引的话其实就会有比较多的种类。然后要选择一个合适的向量索引类型，其实这个就非常关键了。不同的索引算法的话适合不同的数据规模、硬件资源和业务的需求。那么我们看一下主流的几种向量索引的类型，他们怎么呃具体适合什么样的场景和呃调优。有的要点我们先来看一下H N W这种的话可以呃一句话总结，就是它是一个分层的小的一个呃图图结构。然后它可以呃通过分层的图结构的话，可以快速的缩小检索的范围。而适合的数据量的话大概在10 10亿以内都是没问题的。然后内存资源需要充足，然后对检索要求非常高的一个场景。因为的话H W是一个全内存的一个呃索引，而它的呃N和两个参数的话，它是可以在呃提升它的召回率的时候，但是话它也可以他需要牺牲它的延时来提供它的召回率。而H W杠pq的话就是一个量化压缩的一个缩影。它是在hw的基础上那样的话做了一个pq的压缩，然后适合数据量更大。然后但是话内存比较敏感的就是说我更大数据量，但是话我没那么多内存这样的场景下面去使用的。而它可以通过降呃降维来换内存，通常的每降为5%的一个内存的话，召召回率会下降1%左右。而dis的话它就是一个呃图加sd缓存的这么一个索引。然后dis它适合一个超大的数据量类，如说呃10亿以上内存有限。但是的话sd资源呃充足的一些场景，他通常他通过C的缓存的话来降低对内存的一个依赖。它也是可以通过呃牺牲延迟的那个来那个提升召回率，来调整它的参数。而park的话就是我们百度自研的一个呃检索算法。它通过多极的量化和动态的裁剪，能在有限的算力上面的话实现较快的一个检索。他也同样的在那个牺牲延时的时呃情况下的话，召回率也会有略微的下降，1%到3%吧，就降低它的一个裁剪的层数。而最后一个这个的话就是fate的这个全量的暴力检索的这个索以所以这个所以这就非常的呃简单，因为的话它是最精确的一个检索的方式。适合数据量很很小的100万以内，或者是对精度要求极高的一个实验场景。他会对所有的向量都做一遍便利的计算，结果的召回率是恒定的，百分百的1个精确。但是它消耗的资源肯定也是越大，延迟也是比较高的。费的的话就不需要什么调仓了，他恒定就是百分百的1个召回率。然后说完我们的一个索引之外，那么我们具体在呃在业务场景里面具体有怎样的一个查询检索的方式，能够让我们业务更符合我们的一个呃需求需求呢？那么在向量检索呃向量数据库的检索方式里面的话，最核心最常用的其实就是向量检索。那什么是向量检索？简单的来说就是基于向量之间的相似度，比如余弦的相似度类积或是L 2距离的一个计算，来查找目标向量最接近的一个数据。然后我们可以把每一条数据都用一个呃向量来表示。比如说一段文本啊，一个图片，甚至一个用户的行为特征。然后我们有一个查询向量的时候，系统就会帮我们在所有的数据里面找出最相似的向量，也就是最相关的一些内容。这种方式的话就非常适合在呃语义理解呃，推荐检索这些场景里面的。然后典型的呃系统场景呃典型的场景的话就是说我们在一些呃系统中进行呃，比如说给一些用户推荐最相关的一些内容呃商品。呃，也呃在相似性图片检索里面的话，比如说呃我们用呃大模型的embed然后，把图片文本都转换成向量，然后找出最相似的一个图文的一个简搜索的一个内容。然后呃在向量检索里面的话，还可以和结构结构条件过滤这东西结合起来，来进行一个呃多种的一个混合的一个查询。这个我们后边可以呃会继续看到，然后也可以看到我们例子里面的话也提到呃怎么去做一个向量的检索。那么除了刚刚的向下检索，那么全文检索它呃刚刚也说了，它其实也是一种呃非常常用且很重要的一个能力。全文检索的话就是刚刚说的是基于一个倒排索引来实现的，能够支持关键词短语的高效的一个匹配和定位。然后全文检索的核心是不是倒排索引呢？它就是把每一个呃把你想要检索的文字的内容跟它的一个建立一个迟到文本的映映射。这样子的话就可以快速定位到我们需要搜索的内容。而向呃另外一个的话就是刚刚提到一个向量，那么一个向量检索能不能做多个向量并行的检索呢？这个是无永镜是可以的，就像刚刚我们的一个视频的场景里面，呃，我们可以既搜索说类似于说我们娱乐项的视频，并且呃那个音乐里面有有啊那个音频里面带有某些主题的文字。然后视频内容是某些呃类型的，一个是儿童像的内容还是怎么样的内容。然后三个同时进行一个向量的一个检索。在这种多向量检索场景里面的话，就可以用到我的v的一个search。这种search的话就可以进行一个多向量的一个检索。那么刚刚捡到的向量检索，全文检索和那个多向量检索这么多种方式。那么我们是否可以进行一个混合在一起进行一个检索呢？这个也是可以的。呃，在实际检呃检索系统里面，其实混合检索就是我们真实要落地的一个检索能力。因为的话它可以把我们多种检索能力呃有机的结合起来。比如说我们结构化过滤，全文的条件匹配，向量的相似度检索，这些的话都可以在一次查询里面执行，极大提高我们的检索的一个灵活度和一个效果。举个例子的话，就是说他的核心思想就是把我们结构化的呃条件过滤，如那个品牌和状态的过滤。然后全文检索像类似于说关键词和短语的匹配，向量检索，语义的相似度和内容的理解。这些结合起来来组合成一个呃非常精准的一个匹配匹配模式，来找出我们想要的内容。那么呃在实际项目里面的话，刚刚我们所有的检索都用完了。那么用这些东西我们会给我们带来多少的成本？这个东西的话其实我们也做了一些呃经验值的一些分享吧。就是在大概1万1亿条的向量呃那个呃场景里面的话，H I W P Q呃f呃p和dism这几种他们分别的内存使用，磁盘使用和它的一个和那个成本，其实这里都给大家总总结出来了。可以呃一句话说，就是从上往下的话就是H S W是性能最好，但是的话他的费用成本是越高。呃，相对的dis的话就是一个呃那个内存使用率最低的。但是的话它相对的磁盘呃容量的使用率会更高，然后它的耗时是最大的，而它的整个的一个成本也是最低的。那么讲完这么多的话，呃，我们可以呃稍微再讲几个，就是呃web b在一些实际案例里面的一些落地的一个情况吧。百度文库应该大家都呃比较熟悉，它是一个中国国内最大的一个内容管理和消费的一个服务平台之一。然后他的一个产品月活基本高达是9000万，然后付费客户的也高达4000万。他们在原有的业务架构上的话，呃，性能它是有呃比较有有就有上限的，然后检索也比较呃过高，并且它的海量的数据也难以知呃，都会有瓶颈了。然后使用像素库之后，因为它是一个分布式，还有一个那个多分片的，还动能动态扩容的。并且它也有基于呃向量场景的一个内核集的一个优化。所以的话在落地完之后，文库的整体的呃检索性能它都提升了四倍。然后整体性价比的话提供了七七倍，满足了业务在千亿级别的一个向量的一个检索。而另外的一个落地的场景的话，就是我们的一个有价智能体。有价智能体化主要是呃用于我把像数据库的话，服务于它一个test to circle的一个模型。利用test to circle的话就是减少他的一个错误回答的一个问题，来提升他的一个准确率相关性。在最最终的话整个有价智能体的话，它里面是覆盖了两万多的专业的名词和5500千家的一个测系。在这么多的数据里面的话，能达到95%的一个查询的准确率和85%的一个召回率，这是一个非常高的一个数据。而在最后的一个案例里面的话，是我们的品牌智能体。品牌智能体的话从以前的呃历史的架构里面的话，在数据存呃向量数据的存储和检索这环节呃，替换成向量数据库之后，整体的端到端的一个呃落地效果的话是从8个小时生效。到秒级生效。所以的话这也是一个非常大的一个业务的一个提升。那整体的呃30分钟时间基本上就到了。那么呃后面的话如果同学有其他的问题的话，可以扫码，然后关注一下我们的呃百度智能云的先方的官官方的公众号，然后也可以回回复留言，下载我们今天的一些课件，然后也可以留言。呃，我们有有什么问题的话也可以留言，然后后面的话我们可以线下来进行解答。好，感谢各位。",
  "title": "",
  "author": "",
  "publish_date": "",
  "source": "Bilibili (via SnapAny + Paraformer)",
  "language": "zh-CN",
  "word_count": 8551,
  "extraction_method": "snapany_paraformer",
  "extraction_timestamp": "2025-11-06T14:19:21.123400",
  "batch_id": "20251106_023619",
  "link_id": "bili_req5",
  "error": null
}